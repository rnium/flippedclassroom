{% extends 'classroom/base.html' %}
{% block style %} {% load static %}
<link rel="stylesheet" href="{% static 'classroom/styles/style.css' %}">
<link rel="stylesheet" href="{% static 'classroom/styles/navbar.css' %}">
<link rel="stylesheet" href="{% static 'classroom/styles/loaders.css' %}">
{% endblock style %}
{% block title %}<title>{{classroom.name}}</title>{% endblock title %}
{% block nav %}
<ul class="navbar-nav mb-2 mb-lg-0">
  <li class="nav-item">
    <a class="nav-link active" aria-current="page" href="#">Dashboard</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'classroom:classroom_connections' classroom.id %}">Connections</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'classroom:view_assessment' classroom.id %}">Assessment</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{% url 'classroom:classroom_about' classroom.id %}">About</a>
  </li>
</ul>
{% endblock nav %}
{% block content %}
<div class="left-col">
  <div class="classroom-info">
    <div class="title">{{ classroom.name }}</div>
    <div class="num-students">{{ classroom.course }}</div>
    <div class="share-link">
      <button id="share-link">copy join link <i class='bx bx-copy'></i><div id="copy-info" class="copy-info" style="display: none;">copied</div></button>
    </div>
  </div>
  <div class="weeklies title-box">
    <div class="title">Weeklies</div>
    <div class="content">
      {% if classroom.has_weeklies %}
      <ul>
        {% for weekly in classroom.weeklies %}
        <li>
          <a href="{% url 'weeklies:weeklydetail' weekly.classroom.id weekly.weeknum %}">
            <div class="week">
              <div class="week-no">
                <span class="weektext">Week</span>
                <span class="num">{{ weekly.weeknum }}</span>
              </div>
              <div class="icon">
                <i class='bx bxs-calendar-week'></i>
              </div>
            </div>
          </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <div class="no-content">
        <div class="icon-rotated"><i class='bx bx-calendar-week'></i></div>
        <div class="info">No Weeklies</div>
      </div>
      {% endif %}
      {% if request.user in classroom.teachers.all %}
      <div class="create-weekly">
        <div class="weekly-topic-inp-con" id="weekly-topic-inp-con" style="display: none;">
          <input type="text" placeholder="Weekly Topic (optional)" id="weekly-topic-input">
        </div>
        <div class="btns" id="create-weekly-btns-con">
          <button class="create" id="create-weekly-btn">Create Weekly</button>
          <button class="cancel" id="create-weekly-cancel-btn" style="display: none;">Cancel</button>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% if request.user in classroom.teachers.all %}
  <div class="postbox" id="id_postbox" href="#">
    <div class="form">
      <div class="inset-float-textinput">
        <textarea name="description" id="post-descr"></textarea>
        <label for="post-descr">Post description</label>
        <div class="topic-input">
          <input type="text" placeholder="Topics (comma separated)" id="topics">
        </div>
      </div>
      <div class="form-actions">
        <div class="attachement-container input-file">
          <input type="file" id="post-files" name="post-file" multiple="multiple">
          <label for="post-files"><i class='bx bx-paperclip'></i>Attach Files</label>
          <div class="selected-file" id="postfiles-file">No files selected</div>
        </div>
        <div class="submit-container">
          <button type="submit" id="create-post">Post
            <div class="loader" id="loader" style="display: none;">
              <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <div class="recent-posts" id="recent-posts">
    <div class="loader">
      <div class="lds-ripple"><div></div><div></div></div>
      <div class="info text-muted">Loading Posts</div>
    </div>
  </div>

</div>
<div class="right-col">
  {% if teacher_tests %}
  <div class="live-tests title-box" id="live_tests">
    <div class="title">Ongoing Tests</div>
    <div class="content">
      <ul>
        {% for test in teacher_tests %}
        <li>
          <div class="test-item">
            <i class='bx bx-edit-alt'></i>
            <div class="info">
              <a href="{% url 'weekly_test:view_test' test.id %}" class="label-title">{{ test.title }}</a>
              <div class="ending-time">
                <i class='bx bx-timer'></i>
                <div class="time-con">
                  <span class="label">Ending in:</span>
                  <span class="time" id="testid-{{test.id}}">{{test.expiration|date:"c"}}</span>
                </div>
              </div>
              <div class="stat">
                <div class="issued"><i class='bx bx-user-check'></i><span>Issued:&nbsp;</span><span class="value" id="{{test.id}}-issued">{{ test.num_answer_sheets }}</span></div>
                <div class="submitted"><i class='bx bx-check-double'></i><span>Submitted:&nbsp;</span><span class="value" id="{{test.id}}-submitted">{{ test.num_submitted_answer_sheets }}</span></div>
              </div>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
  {% if student_tests %}
  <div class="live-tests title-box" id="live_tests">
    <div class="title">Ongoing Tests</div>
    <div class="content">
      <ul>
        {% for test in student_tests %}
        <li>
          <div class="test-item">
            <i class='bx bx-edit-alt'></i>
            <div class="info">
              <div class="label-title">{{ test.title }}</div>
              <div class="ending-time">
                <i class='bx bx-timer'></i>
                <div class="time-con">
                  <span class="label">Ending in:</span>
                  <span class="time" id="testid-{{test.id}}">{{test.expiration|date:"c"}}</span>
                </div>
              </div>
              <div class="action">
                <a href="{% url 'weekly_test:take_test' test.id %}">Participate</a>
              </div>
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}

  <div class="weekly-tests title-box">
    <div class="title">Weekly Test</div>
    <div class="content">
      {% if classroom.non_live_tests.has_nl_tests %}
      <ul>
        {% for up_test in classroom.non_live_tests.up_tests %}
        <li>
          <div class="test test-upcoming list-item">
            <i class='ico bx bxs-edit-alt'></i>
            <div class="info">
              <div class="label-title">{{up_test.title}}<div class="w-info-con"><span class="week-badge shadow-sm"><span class="w-num">{{up_test.weeknum_str}}</span><i class='{{up_test.section_icon_css}}'></i></span></div> </div>
              <div class="held-on"><span class="sub-title">Schedule:</span><span class="time" id="{{up_test.id}}">{{up_test.schedule|date:"c"}}</span></div>
            </div>
          </div>
        </li>
        {% endfor %}
        {% for prev_test in classroom.non_live_tests.prev_tests %}
        <li>
          <a href="{% url 'weekly_test:view_test' prev_test.id %}">
            <div class="test list-item">
              <i class='ico bx bx-edit-alt'></i>
              <div class="info">
                <div class="label-title">{{prev_test.title}}<div class="w-info-con"><span class="week-badge shadow-sm"><span class="w-num">{{prev_test.weeknum_str}}</span><i class='{{prev_test.section_icon_css}}'></i></span></div> </div>
                <div class="held-on"><span class="sub-title">held on:</span><span class="time" id="testid-{{prev_test.id}}">{{prev_test.schedule|date:"c"}}</span></div>
              </div>
            </div>
          </a>
        </li>
        {% endfor %}   
        </ul>
      {% else %}
      <div class="no-content"><i class='bx bx-info-circle'></i><span>No Tests</span></div>
      {% endif %}
    </div>
  </div>

  <div class="weekly-tasks title-box">
    <div class="title">Assigned Task</div>
    <div class="content">
      {% if classroom.all_tasks.has_tasks %}
      <ul>
        {% for on_task in classroom.all_tasks.ongoing_task %}
        <li>
          <a href="{% url 'classroom:tasks:view_task' on_task.classroom.id on_task.id %}">
            <div class="assignment due list-item">
              <i class='ico {{on_task.task_type_ico_css}}'></i>
              <div class="info">
                <div class="label-title">{{on_task.title}}<div class="w-info-con"><span class="week-badge shadow-sm"><span class="w-num">{{on_task.weeknum_str}}</span><i class='{{on_task.section_icon_css}}'></i></span></div></div>
                <div class="deadline"><span class="sub-title">Ending:</span><span class="time" id="taskid-{{on_task.id}}">{{on_task.deadline|date:"c"}}</span></div>
              </div>
            </div>
          </a>
        </li>
        {% endfor %}
        {% for p_task in classroom.all_tasks.prev_task %}
        <li>
          <a href="{% url 'classroom:tasks:view_task' p_task.classroom.id p_task.id %}">
            <div class="assignment list-item">
              <i class='ico {{p_task.task_type_ico_css}}'></i>
              <div class="info">
                <div class="label-title">{{p_task.title}}<div class="w-info-con"><span class="week-badge shadow-sm"><span class="w-num">{{p_task.weeknum_str}}</span><i class='{{p_task.section_icon_css}}'></i></span></div></div>
                <div class="deadline"><span class="sub-title">Ended:</span><span class="time" id="taskid-{{p_task.id}}">{{p_task.deadline|date:"c"}}</span></div>
              </div>
            </div>
          </a>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <div class="no-content"><i class='bx bx-info-circle'></i><span>No Tasks</span></div>
      {% endif %}
      
      
    </div>
  </div>

</div>
{% csrf_token %}
{% endblock content %}

{% block script %}
<script>
  const join_link = "{{ join_link }}"
  const classroom_id = "{{ classroom.id }}"
  const post_create_url = "{% url 'classroom:post_to_classroom' classroom.id %}"
  const weekly_create_url = "{% url 'weeklies:create_weekly' classroom.id %}"

</script>
<script src="{% static 'classroom/scripts/classroom_dash.js' %}"></script>
{% endblock script %}