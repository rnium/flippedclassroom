{% extends 'classroom/base.html' %}
{% block style %} {% load static %}
<link rel="stylesheet" href="{% static 'classroom/styles/style.css' %}">
<link rel="stylesheet" href="{% static 'classroom/styles/navbar.css' %}">
{% endblock style %}
{% block title %}<title>WeeklyClassroom</title>{% endblock title %}
{% block content %} {% load static %}
<div class="classrooms-dashboard">
  {% if classrooms %}
    {% if classrooms.my_teachings %}
    <div class="my-teachings classes-section">
      <div class="heading">
        <div class="content">
          <i class='bx bx-user-voice'></i><span>My Teachings</span>
        </div>
      </div>
      <div class="classrooms-container">
        {% for classroom in classrooms.my_teachings %}
        <a class="classroom" href="{% url 'classroom:classroom_detail' classroom.id %}">
          <div class="classroom-heading">
            <img src="{{classroom.banner_url}}" class="bg">
            <div class="title">{{ classroom.name }}</div>
            <div class="course">{{ classroom.course }}</div>
          </div>
          <div class="info">
            <div class="num-students i-item">
              <i class='bx bx-group'></i><span>{{ classroom.num_students }} Students</span>
            </div>
            <div class="event-info i-item">
              <i class='bx bx-calendar-event'></i><span>{{classroom.num_weeklies}} Weeklies</span>
            </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}
    {% if classrooms.my_learnings %}
    <div class="my-learnings classes-section">
      <div class="heading">
        <div class="content">
          <i class='bx bx-book'></i><span>My Learnings</span>
        </div>
      </div>
      <div class="classrooms-container">
        {% for classroom in classrooms.my_learnings %}
        <a class="classroom" href="{% url 'classroom:classroom_detail' classroom.id %}">
          <div class="classroom-heading">
            <img src="{{classroom.banner_url}}" class="bg">
            <div class="title">{{ classroom.name }}</div>
            <div class="course">{{ classroom.course }}</div>
          </div>
          <div class="info">
            <div class="last-post-info i-item">
              <i class='bx bx-history'></i><span>last posted: {% if classroom.last_post_time %}{{ classroom.last_post_time|date:'j M, Y' }}{% else %}Never{% endif %}</span>
            </div>
            <div class="event-info i-item">
              <i class='bx bx-calendar-event'></i><span>{{classroom.num_weeklies}} weeklies</span>
            </div>
          </div>
        </a>
        {% endfor %}
        
      </div>
    </div>
    {% endif %}
    {% if not request.user.account.is_email_verified %}
    <div class="email-unverified shadow-lg" id="email-unv-con" style="display: none;">
      <div class="info-con" id="verification-info-con">
        <i class='bx bx-message-square-error'></i>
        <div class="info">Your email is not verified yet! Please verify now to enable recovery option</div>
      </div>
      <div class="btn-con mt-2" id="verification-btn-con">
        <button class="btn btn-primary" id="send-verification-btn">Send verification</button>
        <button class="btn btn-outline-secondary ms-1 close-btn" id="close-verification-con-btn">Close</button>
      </div>
    </div>
    {% endif %}
    <div class="create-classroom-link">
      <a href="{% url 'classroom:create_classroom' %}"><i class='bx bxs-plus-circle'></i></a>
    </div>
  {% else %}
  <div class="p-5 mb-4 bg-light rounded-3">
    <div class="container-fluid py-5">
      <h1 class="display-6 fw-bold">Welcome</h1>
      <p class="col-md-8 fs-4">Hmm.. Seems like you are not part of any active classroom! Create one or ask your teacher or any of your teammates for a join link.</p>
      <a href="{% url 'classroom:create_classroom' %}" class="btn btn-primary btn-lg" type="button">Create Classroom</a>
    </div>
  </div>
  {% if not request.user.account.is_email_verified %}
    <div class="email-unverified shadow-lg" id="email-unv-con" style="display: none;">
      <div class="info-con" id="verification-info-con">
        <i class='bx bx-message-square-error'></i>
        <div class="info">Your email is not verified yet! Please verify now to enable recovery option</div>
      </div>
      <div class="btn-con mt-2" id="verification-btn-con">
        <button class="btn btn-primary" id="send-verification-btn">Send verification</button>
        <button class="btn btn-outline-secondary ms-1 close-btn" id="close-verification-con-btn">Close</button>
      </div>
    </div>
    {% endif %}
  {% endif %}
  
</div>
{% endblock content %}

{% block script %}
<script src="{% static 'classroom/scripts/all_classrooms.js' %}"></script>
<script>
  const send_mail_api_url = "{% url 'accounts:send_verification_email_api'  %}";
</script>
{% endblock script %}
